<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title block that can be overridden by child templates -->
    <title>{% block title %}{% endblock %}</title>

    <!-- Styles block that can be overridden by child templates -->
    {% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    {% endblock %}

    <!-- Preconnect to Google Fonts and include Poppins font family -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Include Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/be7301d8aa.js" crossorigin="anonymous"></script>

    <!-- Include jQuery for AJAX -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- Navigation bar -->
    <nav class="navbar">
        <ul class="navbar-nav">
            <!-- Home link with icon -->
            <li class="nav-item">
                <a href="/" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                        <!-- Font Awesome SVG icon for home -->
                        <path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/>
                    </svg>                
                    <span class="link-text">Home</span>
                </a>
            </li>

            <!-- Power link with icon -->
            <li class="nav-item">
                <a href="/power" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                        <!-- Font Awesome SVG icon for power controls -->
                        <path d="M96 0C78.3 0 64 14.3 64 32v96h64V32c0-17.7-14.3-32-32-32zM288 0c-17.7 0-32 14.3-32 32v96h64V32c0-17.7-14.3-32-32-32zM32 160c-17.7 0-32 14.3-32 32s14.3 32 32 32v32c0 77.4 55 142 128 156.8V480c0 17.7 14.3 32 32 32s32-14.3 32-32V412.8C297 398 352 333.4 352 256V224c17.7 0 32-14.3 32-32s-14.3-32-32-32H32z"/>
                    </svg>                    
                    <span class="link-text">Power</span>
                </a>
            </li>

            <!-- Feed link with icon -->
            <li class="nav-item">
                <a href="/feed" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                        <!-- Font Awesome SVG icon for video feeds -->
                        <path d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2V384c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64L416 337.1V320 192 174.9l14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z"/>
                    </svg>                
                    <span class="link-text">Feed</span>
                </a>
            </li>

            <!-- Network link with icon -->
            <li class="nav-item">
                <a href="/network" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                        <!-- Font Awesome SVG icon for network -->
                        <path d="M256 64H384v64H256V64zM240 0c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48h48v32H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96v32H80c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48H240c26.5 0 48-21.5 48-48V368c0-26.5-21.5-48-48-48H192V288H448v32H400c-26.5 0-48 21.5-48 48v96c0 26.5 21.5 48 48 48H560c26.5 0 48-21.5 48-48V368c0-26.5-21.5-48-48-48H512V288h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H352V192h48c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48H240zM96 448V384H224v64H96zm320-64H544v64H416V384z"/>
                    </svg>                    
                    <span class="link-text">Network</span>
                </a>
            </li>

            <div class="navbar-bottom">
                <!-- IP subnet calculator button with icon -->
                <li class="nav-item">
                    <button id="subnetCalculatorButton" class="nav-link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                            <!-- Font Awesome SVG icon for calculator -->
                            <path d="M64 0C28.7 0 0 28.7 0 64L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-384c0-35.3-28.7-64-64-64L64 0zM96 64l192 0c17.7 0 32 14.3 32 32l0 32c0 17.7-14.3 32-32 32L96 160c-17.7 0-32-14.3-32-32l0-32c0-17.7 14.3-32 32-32zm32 160a32 32 0 1 1 -64 0 32 32 0 1 1 64 0zM96 352a32 32 0 1 1 0-64 32 32 0 1 1 0 64zM64 416c0-17.7 14.3-32 32-32l96 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-96 0c-17.7 0-32-14.3-32-32zM192 256a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm32 64a32 32 0 1 1 -64 0 32 32 0 1 1 64 0zm64-64a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm32 64a32 32 0 1 1 -64 0 32 32 0 1 1 64 0zM288 448a32 32 0 1 1 0-64 32 32 0 1 1 0 64z"/>
                        </svg>
                        <span class="link-text">Subnet Calculator</span>
                    </button>
                </li>

                <!-- Refresh button with icon -->
                <li class="nav-item">
                    <button class="nav-link" onclick="reloadPage()">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <!-- Font Awesome SVG icon for refresh -->
                            <path d="M105.1 202.6c7.7-21.8 20.2-42.3 37.8-59.8c62.5-62.5 163.8-62.5 226.3 0L386.3 160H352c-17.7 0-32 14.3-32 32s14.3 32 32 32H463.5c0 0 0 0 0 0h.4c17.7 0 32-14.3 32-32V80c0-17.7-14.3-32-32-32s-32 14.3-32 32v35.2L414.4 97.6c-87.5-87.5-229.3-87.5-316.8 0C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5zM39 289.3c-5 1.5-9.8 4.2-13.7 8.2c-4 4-6.7 8.8-8.1 14c-.3 1.2-.6 2.5-.8 3.8c-.3 1.7-.4 3.4-.4 5.1V432c0 17.7 14.3 32 32 32s32-14.3 32-32V396.9l17.6 17.5 0 0c87.5 87.4 229.3 87.4 316.7 0c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.5 62.5-163.8 62.5-226.3 0l-.1-.1L125.6 352H160c17.7 0 32-14.3 32-32s-14.3-32-32-32H48.4c-1.6 0-3.2 .1-4.8 .3s-3.1 .5-4.6 1z"/>
                        </svg>
                        <span class="link-text">Refresh</span>
                    </button>
                </li>
            </div>
        </ul>
    </nav>
    <!-- Popup Modal for Subnet Calculator -->
    <div id="subnetCalculatorModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeSubnetCalculator()">&times;</span>
            <h2>IP Subnet Calculator</h2>
            <div class="calculator">
                <input type="text" id="ipInput" placeholder="Enter IP address">
                <div class="keypad">
                    <div class="keys">
                        <button onclick="appendToInput('7')">7</button>
                        <button onclick="appendToInput('8')">8</button>
                        <button onclick="appendToInput('9')">9</button>
                        <button onclick="appendToInput('4')">4</button>
                        <button onclick="appendToInput('5')">5</button>
                        <button onclick="appendToInput('6')">6</button>
                        <button onclick="appendToInput('1')">1</button>
                        <button onclick="appendToInput('2')">2</button>
                        <button onclick="appendToInput('3')">3</button>
                        <button onclick="appendToInput('.')">.</button>
                        <button onclick="appendToInput('0')">0</button>
                        <button onclick="clearInput()">Clear</button>
                    </div>
                </div>
                <div class="subnet-selector">
                    <label for="subnetSelect">Subnet:</label>
                    <select id="subnetSelect">
                        <option value="24">/24</option>
                        <option value="25">/25</option>
                        <option value="26">/26</option>
                        <option value="27">/27</option>
                    </select>
                    <input type="text" id="subnet-input" class="subnet-input" style="display: none;">
                    <button id="toggleSubnetButton" class="subnet-btn" onclick="toggleSubnetInput()">Custom</button>
                </div>
                <button class="calculate" onclick="calculateSubnet()">Calculate</button>
                <div id="subnetResult"></div>
            </div>
        </div>
    </div>
    <main>
        {% block content %}{% endblock %}
    </main>
</body>

<script>
    // Global variable to keep track of the active input field
    let activeInputField = null;

    // Open the subnet calculator modal
    document.getElementById('subnetCalculatorButton').onclick = function() {
        document.getElementById('subnetCalculatorModal').style.display = 'block';
        // Set focus to the IP input field by default
        document.getElementById('ipInput').focus();
        activeInputField = document.getElementById('ipInput');
    }

    // Close the subnet calculator modal
    function closeSubnetCalculator() {
        document.getElementById('subnetCalculatorModal').style.display = 'none';
    }

    // Function to handle input focus changes
    function setActiveInputField(event) {
        activeInputField = event.target;
    }

    // Append value to the currently focused input field
    function appendToInput(value) {
        if (activeInputField) {
            activeInputField.value += value;
        }
    }

    // Clear the currently focused input field
    function clearInput() {
        if (activeInputField) {
            activeInputField.value = '';
        }
    }

    // Show the subnet input field
    function toggleSubnetInput() {
        var subnetSelect = document.getElementById('subnetSelect');
        var subnetInput = document.getElementById('subnet-input');
        var toggleButton = document.getElementById('toggleSubnetButton');

        if (subnetInput.style.display === 'none') {
            // Show subnet input field and hide selector
            subnetSelect.style.display = 'none';
            subnetInput.style.display = 'block';
            toggleButton.innerText = 'Select'; // Update button text
            // Set focus to subnet input
            subnetInput.focus();
            activeInputField = subnetInput;
        } else {
            // Show subnet selector and hide input field
            subnetSelect.style.display = 'block';
            subnetInput.style.display = 'none';
            toggleButton.innerText = 'Custom'; // Update button text
            // Set focus to subnet selector
            subnetSelect.focus();
            activeInputField = subnetSelect;
        } 
    }

    // Calculate the subnet details
    async function calculateSubnet() {
        const subnetSelect = document.getElementById('subnetSelect');
        const subnetInput = document.getElementById('subnet-input');
        const subnetResult = document.getElementById('subnetResult');
        const ip = document.getElementById('ipInput').value;
   
        let subnet;
   
        if (subnetInput.style.display === 'block') {
            // If subnet input is visible, use its value
            subnet = String(subnetInput.value).replace('/', '');
        } else {
            // If subnet selector is visible, use its value
            subnet = subnetSelect.value;
        }

        try {
            let response = await fetch('/calculate_subnet', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ ip: ip, subnet: subnet })
            });

            if (!response.ok) throw new Error('Network response was not ok');

            let result = await response.json();
            document.getElementById('subnetResult').innerText = `IP: ${result.ip} Subnet: /${result.subnet}\nNetwork Address: ${result.network_address}\nUsable Host IP Range: ${result.usable_ip_range}\nBroadcast Address: ${result.broadcast}\nSubnet Mask: ${result.mask}`;
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('subnetResult').innerText = 'An error occurred. Please try again.';
        }
    }
    
    function reloadPage() {
        location.reload();
    }

    // Event listeners for the input fields
    document.getElementById('ipInput').addEventListener('click', setActiveInputField);
    document.getElementById('subnet-input').addEventListener('click', setActiveInputField);

    // Initial focus setup
    document.getElementById('ipInput').focus();
    activeInputField = document.getElementById('ipInput');
</script>

</html>
